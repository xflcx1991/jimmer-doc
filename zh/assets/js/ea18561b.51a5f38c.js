"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[8818],{98019:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>u,contentTitle:()=>x,default:()=>g,frontMatter:()=>h,metadata:()=>l,toc:()=>j});const l=JSON.parse('{"id":"mutation/save-command/association/classification","title":"\u5173\u8054\u5206\u7c7b","description":"\u57fa\u672c\u6982\u5ff5","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/mutation/save-command/association/classification.mdx","sourceDirName":"mutation/save-command/association","slug":"/mutation/save-command/association/classification","permalink":"/jimmer-doc/zh/docs/mutation/save-command/association/classification","draft":false,"unlisted":false,"editUrl":"https://github.com/babyfish-ct/jimmer-doc/edit/main/i18n/zh/docusaurus-plugin-content-docs/current/mutation/save-command/association/classification.mdx","tags":[],"version":"current","lastUpdatedAt":1734792351000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"\u5173\u8054\u5206\u7c7b"},"sidebar":"tutorialSidebar","previous":{"title":"\u5173\u8054\u5bf9\u8c61","permalink":"/jimmer-doc/zh/docs/mutation/save-command/association/"},"next":{"title":"\u62e5\u6709\u65b9\u7279\u6709\u529f\u80fd","permalink":"/jimmer-doc/zh/docs/mutation/save-command/association/owner"}}');var s=i(74848),r=i(28453),a=i(11470),t=i(19365),d=i(64087),c=i(46845),o=i(74400);const h={sidebar_position:1,title:"\u5173\u8054\u5206\u7c7b"},x=void 0,u={},j=[{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:2},{value:"1. \u6309\u7167\u5173\u8054\u5bf9\u8c61\u5f62\u72b6\u5206\u7c7b",id:"1-\u6309\u7167\u5173\u8054\u5bf9\u8c61\u5f62\u72b6\u5206\u7c7b",level:2},{value:"1.1. \u77ed\u5173\u8054",id:"11-\u77ed\u5173\u8054",level:3},{value:"1.1.1. \u5c06Id-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",id:"111-\u5c06id-only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",level:4},{value:"1.1.2. \u5728\u542f\u7528\u4e13\u7528\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\uff0c\u5c06Key-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",id:"112-\u5728\u542f\u7528\u4e13\u7528\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\u5c06key-only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",level:4},{value:"1.2. \u957f\u5173\u8054",id:"12-\u957f\u5173\u8054",level:3},{value:"2. \u6309\u7167\u4fdd\u5b58\u987a\u5e8f\u5206\u7c7b",id:"2-\u6309\u7167\u4fdd\u5b58\u987a\u5e8f\u5206\u7c7b",level:2},{value:"2.1. \u524d\u7f6e\u5173\u8054",id:"21-\u524d\u7f6e\u5173\u8054",level:3},{value:"2.2. \u540e\u7f6e\u5173\u8054",id:"22-\u540e\u7f6e\u5173\u8054",level:3}];function m(n){const e={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,s.jsx)(e.p,{children:"\u53ef\u4ee5\u4ece\u4e24\u79cd\u89d2\u5ea6\u5bf9\u5173\u8054\u5bf9\u8c61\u8fdb\u884c\u5206\u7c7b\uff0c\u4ece\u6bcf\u4e2a\u89d2\u5ea6\u770b\u90fd\u6709\u4e24\u79cd\u5173\u8054\u7c7b\u578b\uff0c\u5171\u8ba14\u79cd"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6309\u7167\u5173\u8054\u5bf9\u8c61\u5f62\u72b6\u5206\u7c7b"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u77ed\u5173\u8054"})}),"\n",(0,s.jsx)(e.p,{children:"\u53ea\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u4e0d\u4f1a\u8fdb\u4e00\u6b65\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9012\u5f52\u4fdd\u5b58\u884c\u4e3a\u88ab\u7ec8\u6b62\uff0c\u4e0d\u4f1a\u7ee7\u7eed\u6df1\u5165\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u957f\u5173\u8054"})}),"\n",(0,s.jsx)(e.p,{children:"\u4e0d\u4f46\u53ef\u4ee5\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u8fd8\u4f1a\u8fdb\u4e00\u6b65\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u9012\u5f52\u4fdd\u5b58\u884c\u4e3a\u4e0d\u4f1a\u88ab\u7ec8\u6b62\uff0c\u4f1a\u7ee7\u7eed\u6df1\u5165\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u6309\u7167\u4fdd\u5b58\u987a\u5e8f\u5206\u7c7b"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u524d\u7f6e\u5173\u8054"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5173\u8054\u5bf9\u8c61\u6bd4\u5f53\u524d\u5bf9\u8c61\u66f4\u65e9\u4fdd\u5b58\uff0c\u5176\u5b9e\u5c31\u662f\u57fa\u4e8e\u4e8e\u5916\u952e ",(0,s.jsx)(e.em,{children:"(\u65e0\u8bba\u771f\u4f2a)"})," \u7684\u5173\u8054\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4f8b\u5982\uff1a\u672c\u6559\u7a0b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"Book.store"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u540e\u7f6e\u5173\u8054"})}),"\n",(0,s.jsx)(e.p,{children:"\u5173\u8054\u5bf9\u8c61\u6bd4\u5f53\u524d\u5bf9\u8c61\u66f4\u665a\u4fdd\u5b58\uff0c\u5305\u62ec\u4e24\u79cd\u60c5\u51b5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u524d\u7f6e\u5173\u8054\u7684\u9006\u5173\u8054\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4f8b\u5982\uff1a\u672c\u6559\u7a0b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"BookStore.books"})]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u57fa\u4e8e\u4e2d\u95f4\u8868\u7684\u5173\u8054\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u4f8b\u5982\uff1a\u672c\u6559\u7a0b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"Book.authors"}),"\u548c",(0,s.jsx)(e.code,{children:"Author.books"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"1-\u6309\u7167\u5173\u8054\u5bf9\u8c61\u5f62\u72b6\u5206\u7c7b",children:"1. \u6309\u7167\u5173\u8054\u5bf9\u8c61\u5f62\u72b6\u5206\u7c7b"}),"\n",(0,s.jsx)(e.h3,{id:"11-\u77ed\u5173\u8054",children:"1.1. \u77ed\u5173\u8054"}),"\n",(0,s.jsx)(e.p,{children:"\u6240\u8c13\u77ed\u5173\u8054\uff0c\u8868\u793a\u4ec5\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054\u672c\u8eab\uff0c\u5bf9\u5173\u8054\u5bf9\u8c61\u7684\u4fee\u6539\u6ca1\u5174\u8da3\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u901a\u5e38\uff0cUI\u8bbe\u8ba1\u4f1a\u91c7\u7528\u5355\u9009\u6846 ",(0,s.jsx)(e.em,{children:"(\u5173\u8054\u5f15\u7528)"})," \u6216\u591a\u9009\u6846 ",(0,s.jsx)(e.em,{children:"(\u5173\u8054\u96c6\u5408)"}),"\u3002"]}),"\n",(0,s.jsx)(d.M,{}),"\n",(0,s.jsx)("div",{children:"\xa0"}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4e2d"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5355\u9009\u6846\u5bf9\u5e94\u591a\u5bf9\u4e00\u5173\u8054",(0,s.jsx)(e.code,{children:"Book.store"})]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u591a\u9009\u6846\u5bf9\u5e94\u591a\u5bf9\u591a\u5173\u8054",(0,s.jsx)(e.code,{children:"Book.authors"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"note",children:(0,s.jsx)(e.p,{children:"\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u5f85\u9009\u6570\u636e\u53ef\u80fd\u5f88\u591a\uff0c\u5e76\u4e0d\u9002\u5408\u8bbe\u8ba1\u4e3a\u4e0b\u62c9UI\u3002\u8fd9\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u5177\u5907\u7b5b\u9009\u6761\u4ef6\u548c\u5206\u9875\u529f\u80fd\u7684\u5bf9\u8c61\u6846\u6765\u4ee3\u66ff\u4e0b\u62c9\u6846\uff0c\u8fd9\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u53d8\u901a\u65b9\u5f0f\u3002"})}),"\n",(0,s.jsxs)(e.p,{children:["\u7531\u4e8e\u7528\u6237\u53ea\u60f3\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u7684\u5173\u8054\uff0c\u4e0d\u60f3\u8fdb\u4e00\u6b65\u4fee\u6539\u5173\u8054\u5bf9\u8c61\uff0c\u6240\u4ee5UI\u4e0d\u53ef\u80fd\u51fa\u73b0\u591a\u5c42\u5173\u8054\u5d4c\u5957\u3002\u8fd9\u5c31\u662f\u79f0\u5176\u4e3a ",(0,s.jsx)(e.strong,{children:"\u77ed\u5173\u8054"})," \u7684\u539f\u56e0\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u4e3asave\u6307\u4ee4\u4f20\u9012\u4efb\u610f\u5f62\u72b6\u7684\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u53c2\u6570\u65f6\uff0c\u6307\u5b9a\u77ed\u5173\u8054\u6709\u4e24\u79cd\u65b9\u6cd5"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5c06Id-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5728\u542f\u7528\u4e13\u7528\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\uff0c\u5c06Key-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"111-\u5c06id-only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",children:"1.1.1. \u5c06Id-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61"}),"\n",(0,s.jsx)(e.p,{children:"\u8ba9\u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027"}),"\n",(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Book book = Immutables.createBook(draft -> {\n    draft.setName("SQL in Action");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("39.9"));\n    \n    // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n    // highlight-next-line\n    draft.setStoreId(2L);\n\n    draft.addIntoAuthors(author -> {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n        // highlight-next-line\n        author.setId(4L);\n    });\n    draft.addIntoAuthors(author -> {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n        // highlight-next-line\n        author.setId(5L);\n    });\n});\nsqlClient.save(book);\n'})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:'val book = Book {\n    name = "SQL in Action"\n    edition = 1\n    price = BigDecimal("39.9")\n\n    // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n    // highlight-next-line\n    storeId = 2L\n\n    authors().addBy {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n        // highlight-next-line\n        id = 4L\n    }\n    authors().addBy {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709id\u5c5e\u6027\n        // highlight-next-line\n        id = 5L\n    }\n}\nsqlClient.save(book)\n'})})})]}),"\n",(0,s.jsxs)(e.admonition,{type:"note",children:[(0,s.jsx)(e.p,{children:"\u8fd9\u91cc\u5bf9\u88ab\u4fdd\u5b58\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u786c\u7f16\u7801\u4ec5\u4e3a\u793a\u8303\uff0c\u5b9e\u9645\u9879\u76ee\u4e2d\u88ab\u4fdd\u5b58\u7684\u6570\u636e\u7ed3\u6784\u7531\u524d\u7aef\u754c\u9762\u63d0\u4ea4\u3002"}),(0,s.jsxs)(e.p,{children:["\u5f53\u7136\uff0c\u5982\u679c\u7528\u6237\u6309\u7167",(0,s.jsx)(e.a,{href:"../../../mapping/advanced/view/id-view",children:"\u6620\u5c04\u7bc7/\u8fdb\u9636\u6620\u5c04/\u89c6\u56fe\u5c5e\u6027/IdView"}),"\u4e00\u6587\u7684\u65b9\u6cd5\u5b9a\u4e49\u4e86",(0,s.jsx)(e.code,{children:"authorIds"}),"\u5c5e\u6027\uff0c\u4e0a\u8ff0\u4ee3\u7801\u53ef\u4ee5\u88ab\u7b80\u5316\uff0c\u4f8b\u5982\uff1a"]}),(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"Book book = ImmutableObjects.createBook(draft -> {\n    draft.setAuthorIds(Arrays.asList(4L, 5L));\n});\n"})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:"val book = Book {\n    authorIds = listOf(4L, 5L)\n}\n"})})})]}),(0,s.jsxs)(e.p,{children:["\u4f46\u8fd9\u5e76\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4e3a\u4e86\u8ba9\u4f8b\u5b50\u66f4\u5177\u666e\u9002\u6027\uff0c\u8fd9\u91cc\u5e76\u4e0d\u5047\u8bbe\u7528\u6237\u4e3a\u5b9e\u4f53\u7c7b\u578b\u5b9a\u4e49\u4e86",(0,s.jsx)(e.a,{href:"../../../mapping/advanced/view/id-view",children:"IdView"}),"\u5c5e\u6027\u3002\u540e\u7eed\u6240\u6709\u6587\u6863\u90fd\u5982\u6b64\uff0c\u4e0d\u518d\u63d0\u9192\u3002"]})]}),"\n",(0,s.jsx)(e.p,{children:"\u751f\u6210\u5982\u4e0bSQL"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4fdd\u5b58\u805a\u5408\u6839\u3002"}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n-- highlight-next-line\n) key(\n    NAME, EDITION\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 39.9 */, \n    ? /* 2 */\n)\n"})})}),(0,s.jsx)(t.A,{value:"mysql",label:"Mysql",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 39.9 */, \n    ? /* 2 */\n-- highlight-next-line\n) on duplicate key update\n    /* fake update to return all ids */ ID = last_insert_id(ID), \n    PRICE = values(PRICE), \n    STORE_ID = values(STORE_ID)\n"})})}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"into into into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 39.9 */, \n    ? /* 2 */\n-- highlight-next-line\n) on conflict(\n    NAME, EDITION\n) do update set\n    PRICE = excluded.PRICE, \n    STORE_ID = excluded.STORE_ID\nreturning ID\n"})})})]}),"\n",(0,s.jsxs)(e.p,{children:["\u7531\u4e8e",(0,s.jsx)(e.code,{children:"Book.store"}),"\u662f\u76f4\u63a5\u57fa\u4e8e\u5916\u952e ",(0,s.jsx)(e.em,{children:"(STORE_ID)"})," \u7684\u591a\u5bf9\u4e00\u5173\u7cfb\uff0c\u5f53\u524d\u5bf9\u8c61\u548c",(0,s.jsx)(e.code,{children:"BookStore(2)"}),"\u5bf9\u8c61\u7684\u5173\u8054\u5c06\u4f1a\u56e0\u8fd9\u6761SQL\u7684\u6267\u884c\u800c\u88ab\u81ea\u52a8\u521b\u5efa\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5982\u679c\u548c\u5f53\u524d\u5bf9\u8c61 ",(0,s.jsxs)(e.em,{children:["(\u65b0\u63d2\u5165\u7684\u6570\u636e\u4e3a",(0,s.jsx)(e.code,{children:"Book(100)"}),")"]})," \u5173\u8054\u7684",(0,s.jsx)(e.code,{children:"Author"}),"\u5bf9\u8c61\u4e0d\u4ec5\u4ec5\u53ea\u6709",(0,s.jsx)(e.code,{children:"Author(4)"}),"\u548c",(0,s.jsx)(e.code,{children:"Author(5)"}),"\uff0c\u5207\u65ad\u548c\u5176\u4ed6\u5bf9\u8c61\u554a\u7684\u5173\u8054\u3002"]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"delete from BOOK_AUTHOR_MAPPING\nwhere \n    BOOK_ID = ? /* 100 */\nand\n    not (\n        AUTHOR_ID = any(? /* [4, 5] */)\n    )\n"})})}),(0,s.jsx)(t.A,{value:"mysql",label:"Mysql",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"delete from BOOK_AUTHOR_MAPPING\nwhere \n    BOOK_ID = ? /* 100 */\nand\n    AUTHOR_ID not in(\n        ? /* 4 */, \n        ? /* 5 */\n    )\n"})})}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"delete from BOOK_AUTHOR_MAPPING\nwhere \n    BOOK_ID = ? /* 100 */\nand\n    not (\n        AUTHOR_ID = any(? /* [4, 5] */)\n    )\n"})})})]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["\u8fd9\u4e2a\u6b65\u9aa4\u53eb\u505a",(0,s.jsx)(e.a,{href:"./dissociation",children:"\u8131\u52fe\u64cd\u4f5c"}),"\uff0c\u540e\u7eed\u6587\u6863\u4f1a\u7ed9\u4e88\u4ecb\u7ecd\uff0c\u8fd9\u91cc\u8bf7\u8bfb\u8005\u5148\u884c\u5ffd\u7565"]})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5efa\u7acb\u5bf9\u8c61 ",(0,s.jsxs)(e.em,{children:["(\u65b0\u63d2\u5165\u7684\u6570\u636e\u4e3a",(0,s.jsx)(e.code,{children:"Book(100)"}),")"]})," \u548c",(0,s.jsx)(e.code,{children:"Author(4)"}),"\u548c",(0,s.jsx)(e.code,{children:"Author(5)"}),"\u4e24\u4e2a\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054"]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK_AUTHOR_MAPPING tb_1_ \nusing(values(?, ?)) tb_2_(\n    BOOK_ID, AUTHOR_ID\n) \non \n    tb_1_.BOOK_ID = tb_2_.BOOK_ID\nand\n    tb_1_.AUTHOR_ID = tb_2_.AUTHOR_ID \n-- highlight-next-line\nwhen not matched \n    then insert(BOOK_ID, AUTHOR_ID)\n    values(tb_2_.BOOK_ID, tb_2_.AUTHOR_ID)\n/* batch-0: [100, 4] */\n/* batch-1: [100, 5] */\n"})})}),(0,s.jsxs)(t.A,{value:"mysql",label:"Mysql",children:[(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL\u7684\u6279\u91cf\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91c7\u7528\uff0c\u800c\u91c7\u7528\u591a\u6761SQL\u3002\u5177\u4f53\u7ec6\u8282\u8bf7\u53c2\u8003",(0,s.jsx)(e.a,{href:"../mysql",children:"MySQL\u7684\u95ee\u9898"})]})}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert \n-- highlight-next-line\nignore\ninto BOOK_AUTHOR_MAPPING(\n    BOOK_ID, AUTHOR_ID\n) values(\n    ? /* 100 */, ? /* 4 */\n)\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert \n-- highlight-next-line\nignore\ninto BOOK_AUTHOR_MAPPING(\n    BOOK_ID, AUTHOR_ID\n) values(\n    ? /* 100 */, ? /* 5 */\n)\n"})}),"\n"]}),"\n"]})]}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK_AUTHOR_MAPPING(\n    BOOK_ID, AUTHOR_ID\n) values(\n    ?, ?\n-- highlight-next-line  \n) on conflict(\n    BOOK_ID, AUTHOR_ID\n)\ndo nothing\n/* batch-0: [100, 4] */\n/* batch-1: [100, 5] */\n"})})})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsx)(e.p,{children:"\u901a\u8fc7\u6b64\u4f8b\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u77ed\u5173\u8054\u53ea\u4f1a\u521b\u5efa\u6216\u9500\u6bc1\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u4e0d\u4f1a\u8fdb\u4e00\u6b65\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002"}),(0,s.jsxs)(e.p,{children:["\u77ed\u5173\u8054\u603b\u662f\u5047\u8bbe\u88ab\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u5b58\u5728\u7684\uff0c\u5982\u679c\u6240\u5f15\u7528\u7684\u5bf9\u8c61 ",(0,s.jsxs)(e.em,{children:["(\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684",(0,s.jsx)(e.code,{children:"BookStore(2)"}),", ",(0,s.jsx)(e.code,{children:"Author(4)"}),"\u548c",(0,s.jsx)(e.code,{children:"Author(5)"}),")"]})," \u4e0d\u5b58\u5728\uff0c\u4f1a\u5bfc\u81f4\u5f02\u5e38\uff01"]})]}),"\n",(0,s.jsx)(e.h4,{id:"112-\u5728\u542f\u7528\u4e13\u7528\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\u5c06key-only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61",children:"1.1.2. \u5728\u542f\u7528\u4e13\u7528\u914d\u7f6e\u7684\u524d\u63d0\u4e0b\uff0c\u5c06Key-Only\u5bf9\u8c61\u4f5c\u4e3a\u5173\u8054\u5bf9\u8c61"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0b\u9762\u4ee3\u7801\uff0c\u5047\u8bbe"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"BookStore"}),"\u7c7b\u578b\u7684key\u5c5e\u6027\u662f",(0,s.jsx)(e.code,{children:"name"})]}),"\n",(0,s.jsx)(o.l,{buttonText:"\u67e5\u770b",title:"BookStore\u7684Key\u5b9a\u4e49",children:(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",metastring:'title="BookStore.java"',children:"@Entity\npublic interface BookStore {\n\n    // highlight-next-line\n    @Key\n    String name();\n\n    ...\u7701\u7565\u5176\u4ed6\u6210\u5458...\n}\n"})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",metastring:'title="BookStore.kt"',children:"@Entity\ninterface BookStore {\n\n    // highlight-next-line\n    @Key\n    val name: String\n\n    ...\u7701\u7565\u5176\u4ed6\u6210\u5458...\n}\n"})})})]})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"Author"}),"\u7c7b\u578b\u7684key\u5c5e\u6027\u662f",(0,s.jsx)(e.code,{children:"firstName"}),"\u548c",(0,s.jsx)(e.code,{children:"lastName"})]}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\u5b9e\u9645\u4e1a\u52a1\u4e2d\uff0c\u8fd9\u4e2a\u552f\u4e00\u6027\u7ea6\u675f\u672a\u5fc5\u5408\u7406\uff0c\u8fd9\u91cc\u4e3a\u7b80\u5316\u4f8b\u5b50\uff0c\u59d1\u4e14\u8fd9\u6837\u5047\u8bbe\u3002"}),"\n"]}),"\n",(0,s.jsx)(o.l,{buttonText:"\u67e5\u770b",title:"Author\u7684Key\u5b9a\u4e49",children:(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",metastring:'title="Author.java"',children:"@Entity\npublic interface Author {\n\n    // highlight-next-line\n    @Key\n    String firstName();\n\n    // highlight-next-line\n    @Key\n    String lastName();\n\n    ...\u7701\u7565\u5176\u4ed6\u6210\u5458...\n}\n"})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",metastring:'title="Author.kt"',children:"@Entity\ninterface Author {\n\n    // highlight-next-line\n    @Key\n    val firstName: String\n\n    // highlight-next-line\n    @Key\n    val lastName: String\n\n    ...\u7701\u7565\u5176\u4ed6\u6210\u5458...\n}\n"})})})]})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Book book = Immutables.createBook(draft -> {\n    draft.setName("SQL in Action");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("39.9"));\n    draft.applyStore(store -> {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`BookStore.name`\n        // highlight-next-line\n        store.setName("MANNING");\n    });\n    draft.addIntoAuthors(author -> {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`Author.firstName`\u548c`Author.lastName`\n        // highlight-next-line\n        author.setFirstName("Boris").setLastName("Cherny");\n    });\n    draft.addIntoAuthors(author -> {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`Author.firstName`\u548c`Author.lastName`\n        // highlight-next-line\n        author.setFirstName("Samer").setLastName("Buna");\n    });\n});\nsqlClient\n    .saveCommand(book)\n    // highlight-next-line\n    .setKeyOnlyAsReference(BookProps.STORE)\n    // highlight-next-line\n    .setKeyOnlyAsReference(BookProps.AUTHORS)\n    .execute();\n'})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:'val book = Book {\n    name = "SQL in Action"\n    edition = 1\n    price = BigDecimal("39.9")\n    store {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`BookStore.name`\n        // highlight-next-line\n        name = "MANNING"\n    }\n    authors().addBy {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`Author.firstName`\u548c`Author.lastName`\n        // highlight-next-line\n        firstName = "Boris"\n        // highlight-next-line\n        lastName = "Cherny"\n    }\n    authors().addBy {\n        // \u5173\u8054\u5bf9\u8c61\u53ea\u6709key\u5c5e\u6027\uff0c\u5373`Author.firstName`\u548c`Author.lastName`\n        // highlight-next-line\n        firstName = "Samer"\n        // highlight-next-line\n        lastName = "Buna"\n    }\n}\nsqlClient.save(book) {\n    // highlight-next-line\n    setKeyOnlyAsReference(Book::store)\n    // highlight-next-line\n    setKeyOnlyAsReference(Book::authors)\n}\n'})})})]}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0bkey-only\u5173\u8054\u5bf9\u8c61\u88ab\u89c6\u4e3a\u957f\u5173\u8054"})}),(0,s.jsxs)(e.p,{children:["\u7136\u800c\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528",(0,s.jsx)(e.code,{children:"setKeyOnlyAsReference"}),"\u65b9\u6cd5\u5c06key-only\u5173\u8054\u5bf9\u8c61\u89c6\u4e3a\u77ed\u5173\u8054\u3002"]}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u91cc\uff0c\u4e24\u6b21\u8c03\u7528",(0,s.jsx)(e.code,{children:"setKeyOnlyAsReference"}),"\u65b9\u6cd5\uff0c\u660e\u786e\u5730\u914d\u7f6e\u5173\u8054",(0,s.jsx)(e.code,{children:"Book.store"}),"\u548c",(0,s.jsx)(e.code,{children:"Book.authors"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8c03\u7528\u4e00\u6b21",(0,s.jsx)(e.code,{children:"setKeyOnlyAsReferenceAll"}),"\u65b9\u6cd5\uff0c\u76f2\u76ee\u5730\u914d\u7f6e\u6240\u6709\u5173\u8054\u5173\u7cfb\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u548cKotlin\u76f8\u6bd4\uff0cJava API\u5bf9\u4fdd\u5b58\u6307\u4ee4\u7684\u9ad8\u7ea7\u914d\u7f6e\u7684\u4fbf\u6377\u6027\u7a0d\u4f4e\u3002"}),"\n",(0,s.jsxs)(e.p,{children:["\u5148\u8c03\u7528",(0,s.jsx)(e.code,{children:"saveCommand"}),"\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u4fdd\u5b58\u6307\u4ee4\u4f46\u4e0d\u7acb\u5373\u6267\u884c\uff0c\u5b8c\u6210\u9ad8\u7ea7\u914d\u7f6e\u540e\uff0c\u518d\u8c03\u7528",(0,s.jsx)(e.code,{children:"execute"}),"\u65b9\u6cd5\u771f\u6b63\u6267\u884c\u3002"]}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(e.h3,{id:"12-\u957f\u5173\u8054",children:"1.2. \u957f\u5173\u8054"}),"\n",(0,s.jsx)(e.p,{children:"\u6240\u8c13\u957f\u5173\u8054\uff0c\u8868\u793a\u9664\u4e86\u8981\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u4e4b\u95f4\u7684\u5173\u8054\u672c\u8eab\u5916\uff0c\u8fd8\u8981\u8fdb\u4e00\u6b65\u4fee\u6539\u5173\u8054\u5bf9\u8c61\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u5e38\uff0c\u8ba2\u5355\u548c\u8ba2\u5355\u660e\u7ec6\u662f\u8fd9\u7c7b\u573a\u666f\u7684\u6700\u4f73\u793a\u8303\uff0cUI\u8bbe\u8ba1\u4f1a\u91c7\u7528\u5185\u5d4c\u8868\u683c\uff0c\u4f8b\u5982"}),"\n",(0,s.jsx)(c.Y,{}),"\n",(0,s.jsx)("div",{children:"\xa0"}),"\n",(0,s.jsxs)(e.p,{children:["\u7531\u4e8e\u7528\u6237\u4e0d\u4f46\u8981\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u7684\u5173\u8054\uff0c\u8fd8\u8981\u8fdb\u4e00\u6b65\u4fee\u6539\u5173\u8054\u5bf9\u8c61\uff0c\u800c\u5173\u8054\u5bf9\u8c61\u53ef\u4ee5\u5305\u542b\u66f4\u6df1\u7684\u5173\u8054\uff0c\u6240\u4ee5\uff0c\u7406\u8bba\u4e0a\u8bb2\uff0cUI\u53ef\u51fa\u591a\u5c42\u5173\u8054\u5d4c\u5957\u3002\u8fd9\u5c31\u662f\u79f0\u5176\u4e3a ",(0,s.jsx)(e.strong,{children:"\u957f\u5173\u8054"})," \u7684\u539f\u56e0\u3002"]}),"\n",(0,s.jsxs)(e.admonition,{type:"note",children:[(0,s.jsx)(e.p,{children:"\u867d\u7136\u8bbe\u8ba1\u4eba\u5458\u4e3a\u4e86\u4fdd\u8bc1UI\u7684\u7b80\u6d01\u6027\u4f1a\u523b\u610f\u907f\u514d\u5728\u5185\u5d4c\u8868\u683c\u4e2d\u5d4c\u5957\u66f4\u6df1\u7684\u5185\u5d4c\u8868\u683c\uff0c\u4f46\u662f\u5b9e\u9645\u9879\u76ee\u4e2d\u4ecd\u7136\u5b58\u5728\u9700\u8981\u5728UI\u4e0a\u7ef4\u62a4\u591a\u5c42\u5d4c\u5957\u5173\u8054\u7684\u573a\u666f\uff0c\u6bd4\u5982\uff1a"}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u8868\u5355\u672c\u8eab\u662f\u4e00\u9897\u6811\u7ed3\u6784\uff0c\u7f16\u8f91\u597d\u4e86\u540e\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4fdd\u5b58\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u53ef\u89c6\u5316UI\u8bbe\u8ba1\uff0c\u56e0\u4e3aUI\u7ec4\u4ef6\u672c\u8eab\u5c31\u662f\u6811\u5f62\u7ed3\u6784\uff0c\u7528\u6237\u8fdb\u884c\u4e00\u7cfb\u5217\u53ef\u89c6\u5316\u62d6\u62c9\u62fd\u7684\u8bbe\u8ba1\u540e\uff0c\u628aUI\u7ec4\u4ef6\u6811\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4fdd\u5b58\u3002"}),"\n"]}),"\n"]}),(0,s.jsxs)(e.p,{children:["Jimmer\u53ef\u4ee5\u76f4\u63a5\u4fdd\u5b58\u4efb\u610f\u5f62\u72b6\u7684\u957f\u5173\u8054\u6570\u636e\u7ed3\u6784\uff0c\u5982\u679c\u628a\u6df1\u5ea6\u672a\u77e5\u7684\u957f\u5173\u8054\u6570\u636e\u7ed3\u6784\u79f0\u4e3a\u590d\u6742\u8868\u5355\uff0c",(0,s.jsx)(e.strong,{children:"\u4fdd\u5b58\u6307\u4ee4\u5c31\u662f\u4e3a\u590d\u6742\u8868\u5355\u800c\u8bbe\u8ba1\u3002"})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5b50\u5982\u4e0b"}),"\n",(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Order order = Immutables.createOrder(draft -> {\n    draft.setCustomerId(1L);\n    draft.setProvince("\u56db\u5ddd");\n    draft.setCity("\u6210\u90fd");\n    draft.setAddress("\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3");\n    // highlight-next-line\n    draft.addIntoItems(item -> {\n        item.setProductId(8L);\n        item.setQuantity(2);\n    });\n    // highlight-next-line\n    draft.addIntoItems(item -> {\n        item.setProductId(9L);\n        item.setQuantity(1);\n    });\n});\nsqlClient.insert(order);\n'})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:'val order = Order {\n    customerId = 1L\n    province = "\u56db\u5ddd"\n    city = "\u6210\u90fd"\n    address = "\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"\n    // highlight-next-line\n    items().addBy {\n        productId = 8L\n        quantity = 2\n    }\n    // highlight-next-line\n    items().addBy {\n        productId = 9L\n        quantity = 1\n    }\n}\nsqlClient.insert(order)\n'})})})]}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f88\u591a\u77ed\u5173\u8054\uff0c\u4f8b\u5982",(0,s.jsx)(e.code,{children:"Order.customer"}),", ",(0,s.jsx)(e.code,{children:"OrderItem.product"}),"\uff0c\u4f46\u662f\uff0c\u4eec\u5e76\u975e\u8fd9\u91cc\u5e94\u8be5\u5173\u6ce8\u7684\u91cd\u70b9\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5e94\u8be5\u5173\u6ce8\u5173\u8054",(0,s.jsx)(e.code,{children:"Order.items"}),"\uff0c\u5f88\u660e\u663e\uff0c\u5b83\u662f\u4e00\u4e2a\u957f\u5173\u8054\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u6b64\u64cd\u4f5c\u4f1a\u751f\u6210\u4e24\u6761SQL"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u63d2\u5165\u6839\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"Order"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into order_(\n    PROVINCE, CITY, ADDRESS, CUSTOMER_ID\n) values(\n    ? /* \u56db\u5ddd */, \n    ? /* \u6210\u90fd */, \n    ? /* \u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3 */, \n    ? /* 1 */\n)\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u63d2\u5165\u6240\u6709\u5b50\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"OrderItem"})]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"\u7edd\u5927\u90e8\u5206\u6570\u636e\u5e93",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into ORDER_ITEM(\n    ORDER_ID, \n    PRODUCT_ID, \n    QUANTITY\n) values(?, ?, ?)\n/* batch-0: [100, 8, 2] */\n/* batch-1: [100, 9, 1] */\n"})})}),(0,s.jsxs)(t.A,{value:"mysql",label:"Mysql",children:[(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL\u7684\u6279\u91cf\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91c7\u7528\uff0c\u800c\u91c7\u7528\u591a\u6761SQL\u3002\u5177\u4f53\u7ec6\u8282\u8bf7\u53c2\u8003",(0,s.jsx)(e.a,{href:"../mysql",children:"MySQL\u7684\u95ee\u9898"})]})}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into ORDER_ITEM(\n    ORDER_ID, \n    PRODUCT_ID, \n    QUANTITY\n) values(\n    ? /* 100 */, \n    ? /* 8 */, \n    ? /* 2 */\n)\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into ORDER_ITEM(\n    ORDER_ID, \n    PRODUCT_ID, \n    QUANTITY\n) values(\n    ? /* 100 */, \n    ? /* 9 */, \n    ? /* 1 */\n)\n"})}),"\n"]}),"\n"]})]})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsx)(e.p,{children:"\u7531\u6b64\u53ef\u89c1\uff0c\u957f\u5173\u8054\u4e0d\u4ec5\u80fd\u4fee\u6539\u5f53\u524d\u5bf9\u8c61\u548c\u5176\u4ed6\u5bf9\u8c61\u7684\u5173\u8054\u5173\u7cfb\uff0c\u8fd8\u662f\u4f1a\u5bfc\u81f4\u5173\u8054\u5bf9\u8c61\u88ab\u4fdd\u5b58\u3002"}),(0,s.jsx)(e.p,{children:"\u5982\u679c\u5173\u8054\u5bf9\u8c61\u4e5f\u5177\u5907\u957f\u5173\u8054\uff0c\u5c06\u4f1a\u9012\u5f52\u4fdd\u5b58\uff0c\u76f4\u5230\u6ca1\u6709\u66f4\u591a\u5173\u8054\u5c5e\u6027\u6216\u9047\u5230\u77ed\u5173\u8054\u4e3a\u6b62\u3002"})]}),"\n",(0,s.jsx)(e.h2,{id:"2-\u6309\u7167\u4fdd\u5b58\u987a\u5e8f\u5206\u7c7b",children:"2. \u6309\u7167\u4fdd\u5b58\u987a\u5e8f\u5206\u7c7b"}),"\n",(0,s.jsx)(e.h3,{id:"21-\u524d\u7f6e\u5173\u8054",children:"2.1. \u524d\u7f6e\u5173\u8054"}),"\n",(0,s.jsxs)(e.p,{children:["\u524d\u7f6e\u5173\u8054\u5c31\u662f\u57fa\u4e8e\u5916\u952e ",(0,s.jsx)(e.em,{children:"(\u65e0\u8bba\u771f\u4f2a)"})," \u7684\u5173\u8054\uff0c\u5176\u5de5\u4f5c\u6a21\u5f0f\u4e3a\uff0c\u5148\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\uff0c\u518d\u4fdd\u5b58\u6839\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'Book book = Immutables.createBook(draft -> {\n    draft.setName("SQL in Action");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("49.9"));\n    draft.applyStore(store -> {\n        store.setName("TURING");\n        store.setWebsite("https://www.turing.com");\n    });\n});\nsqlClient.save(book);\n'})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:'val book = Book {\n    name = "SQL in Action"\n    edition = 1\n    price = BigDecimal("49.9")\n    store {\n        name = "TURING"\n        website = "https://www.turing.com"\n    }\n}\nsqlClient.save(book)\n'})})})]}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5H2\u4e3a\u4f8b\uff0c\u751f\u6210\u4e24\u6761SQL"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5148\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"BookStore"})]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK_STORE(\n    NAME, WEBSITE\n-- highlight-next-line\n) key(\n    NAME\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n)\n"})})}),(0,s.jsx)(t.A,{value:"mysql",label:"Mysql",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK_STORE(\n    NAME, WEBSITE\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n-- highlight-next-line\n) on duplcate update\n    /* fake update to return all ids */ ID = last_insert_id(ID),\n    WEBSITE = VALUES(WEBSITE)\n"})})}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK_STORE(\n    NAME, WEBSITE\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n-- highlight-next-line\n) on conflict(\n    NAME, WEBSITE\n) do update set\n    WEBSITE = excluded.WEBSITE,\nreturn ID\n"})})})]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u540e\u4fdd\u5b58\u5f53\u524d\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"Book"})," ",(0,s.jsxs)(e.em,{children:["(\u5047\u8bbe\u4e0a\u4e2a\u64cd\u4f5c\u8fd4\u56de\u7684id\u4e3a",(0,s.jsx)(e.code,{children:"100"}),")"]})]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n--highlight-next-line\n) key(\n    NAME, EDITION\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 49.9 */, \n    ? /* 100 */\n)\n"})})}),(0,s.jsx)(t.A,{value:"mysql",label:"Mysql",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 49.9 */, \n    ? /* 100 */\n-- highlight-next-line\n) on duplcate key update\n    /* fake update to return all ids */ ID = last_insert_id(ID), \n    PRICE = values(PRICE), \n    STORE_ID = values(STORE_ID)\n"})})}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 49.9 */, \n    ? /* 100 */\n-- highlight-next-line\n) on conflict(\n    NAME, EDITION\n) do update set\n    PRICE = values(PRICE), \n    STORE_ID = values(STORE_ID)\nreturning ID\n"})})})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{type:"caution",children:[(0,s.jsx)(e.p,{children:'\u5728\u5de5\u4f5c\u4ea4\u6d41\u4e2d\uff0c\u9762\u5bf9\u524d\u7f6e\u5173\u8054\u65f6\uff0c\u5efa\u8bae\u7528"\u5f53\u524d\u5bf9\u8c61/\u5173\u8054\u5bf9\u8c61"\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u8868\u8fbe\uff0c\u800c\u4e0d\u662f"\u7236\u5bf9\u8c61/\u5b50\u5bf9\u8c61"\u8fd9\u79cd\u8868\u8fbe\u65b9\u5f0f\u3002'}),(0,s.jsx)(e.p,{children:"\u56e0\u4e3a\uff0c\u5bf9\u4e8e\u524d\u7f6e\u5173\u8054\u800c\u8a00\uff0cORM\u5c42\u9762\u7684\u7236\u5b50\u5173\u7cfb\u548c\u6570\u636e\u5e93\u5efa\u6a21\u5c42\u9762\u7684\u7236\u5b50\u5173\u7cfb\u5b8c\u5168\u76f8\u53cd\uff0c\u975e\u5e38\u5bb9\u6613\u5f15\u8d77\u6df7\u6dc6\u548c\u8bef\u4f1a\u3002"})]}),"\n",(0,s.jsx)(e.h3,{id:"22-\u540e\u7f6e\u5173\u8054",children:"2.2. \u540e\u7f6e\u5173\u8054"}),"\n",(0,s.jsx)(e.p,{children:"\u5176\u4ed6\u5173\u8054\uff0c\u4f8b\u5982"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u524d\u7f6e\u5173\u8054\u7684\u9006\u5173\u8054\uff0c",(0,s.jsxs)(e.em,{children:["(\u672c\u6559\u7a0b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"BookStore.books"}),")"]})]}),"\n",(0,s.jsxs)(e.li,{children:["\u57fa\u4e8e\u4e2d\u95f4\u8868\u7684\u5173\u8054\uff0c",(0,s.jsxs)(e.em,{children:["(\u672c\u6559\u7a0b\u4e2d\u7684",(0,s.jsx)(e.code,{children:"Book.authors"}),"\u548c",(0,s.jsx)(e.code,{children:"Author.books"}),")"]})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u90fd\u53ef\u4ee5\u5f52\u4e3a\u540e\u7f6e\u5173\u8054\uff0c\u662f\u4e00\u79cd\u66f4\u5e38\u89c1\u7684\u573a\u666f\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u540e\u7f6e\u5173\u8054\u7684\u5de5\u4f5c\u6a21\u5f0f\u66f4\u5bb9\u6613\u7406\u89e3\uff0c\u5148\u4fdd\u5b58\u5f53\u524d\u5bf9\u8c61\uff0c\u518d\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61\u3002"}),"\n",(0,s.jsxs)(a.A,{groupId:"language",children:[(0,s.jsx)(t.A,{value:"java",label:"Java",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'BookStore store = Immutables.createBookStore(draft -> {\n    draft.setName("TURING");\n    draft.setWebsite("https://www.turing.com");\n    draft.addIntoBooks(book -> {\n        book.setName("SQL in Action");\n        book.setEdition(1);\n        book.setPrice(new BigDecimal("49.9"));\n    });\n    draft.addIntoBooks(book -> {\n        book.setName("RUST programming");\n        book.setEdition(2);\n        book.setPrice(new BigDecimal("39.9"));\n    });\n});\nsqlClient\n    .saveCommand(store)\n    // \u8bf7\u8bfb\u8005\u5148\u884c\u5ffd\u7565\u6b64\u914d\u7f6e\n    .setTargetTransferModeAll(TargetTransferMode.ALLOWED)\n    .execute();\n'})})}),(0,s.jsx)(t.A,{value:"kotlin",label:"Kotlin",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-kotlin",children:'val store = BookStore {\n    name = "TURING"\n    website = "https://www.turing.com"\n    books().addBy {\n        name = "SQL in Action"\n        edition = 1\n        price = BigDecimal("49.9")\n    }\n    books().addBy {\n        name = "RUST programming"\n        edition = 2\n        price = BigDecimal("39.9")\n    }\n}\nsqlClient.save(store) {\n    // \u8bf7\u8bfb\u8005\u5148\u884c\u5ffd\u7565\u6b64\u914d\u7f6e\n    setTargetTransferModeAll(TargetTransferMode.ALLOWED)\n}\n'})})})]}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5H2\u4e3a\u4f8b\uff0c\u751f\u6210\u4e09\u6761SQL"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u5148\u4fdd\u5b58\u5f53\u524d\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"BookStore"})]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK_STORE(\n    NAME, WEBSITE\n-- highlight-next-line\n) key(\n    NAME\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n)\n"})})}),(0,s.jsx)(t.A,{value:"mysql",label:"Mysql",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK_STORE(\n    NAME, WEBSITE\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n-- highlight-next-line\n) on duplcate update\n    /* fake update to return all ids */ ID = last_insert_id(ID),\n    WEBSITE = VALUES(WEBSITE)\n"})})}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK_STORE(\n    NAME, WEBSITE\n) values(\n    ? /* TURING */, \n    ? /* https://www.turing.com */\n-- highlight-next-line\n) on conflict(\n    NAME, WEBSITE\n) do update set\n    WEBSITE = excluded.WEBSITE,\nreturn ID\n"})})})]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u540e\u4fdd\u5b58\u5173\u8054\u5bf9\u8c61",(0,s.jsx)(e.code,{children:"Book"})," ",(0,s.jsxs)(e.em,{children:["(\u5047\u8bbe\u4e0a\u4e2a\u64cd\u4f5c\u8fd4\u56de\u7684id\u4e3a",(0,s.jsx)(e.code,{children:"100"}),")"]})]}),"\n",(0,s.jsxs)(a.A,{groupId:"database",children:[(0,s.jsx)(t.A,{value:"h2",label:"H2",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"merge into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n-- highlight-next-line\n) key(\n    NAME, EDITION\n) values(?, ?, ?, ?)\n/* batch-0: [SQL in Action, 1, 49.9, 100] */\n/* batch-1: [RUST programming, 2, 39.9, 100] */\n"})})}),(0,s.jsxs)(t.A,{value:"mysql",label:"Mysql",children:[(0,s.jsx)(e.admonition,{type:"caution",children:(0,s.jsxs)(e.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL\u7684\u6279\u91cf\u64cd\u4f5c\u4e0d\u4f1a\u88ab\u91c7\u7528\uff0c\u800c\u91c7\u7528\u591a\u6761SQL\u3002\u5177\u4f53\u7ec6\u8282\u8bf7\u53c2\u8003",(0,s.jsx)(e.a,{href:"../mysql",children:"MySQL\u7684\u95ee\u9898"})]})}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* SQL in Action */, \n    ? /* 1 */, \n    ? /* 49.9 */, \n    ? /* 100 */\n-- highlight-next-line\n) on duplcate update \n    /* fake update to return all ids */ ID = last_insert_id(ID), \n    PRICE = VALUES(PRICE),\n    STORE_ID = VALUES(STORE_ID)\n\n"})}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ? /* RUST programming */, \n    ? /* 2 */, \n    ? /* 39.9 */, \n    ? /* 100 */\n-- highlight-next-line\n) on duplcate update \n    /* fake update to return all ids */ ID = last_insert_id(ID), \n    PRICE = VALUES(PRICE),\n    STORE_ID = VALUES(STORE_ID)\n"})}),"\n"]}),"\n"]})]}),(0,s.jsx)(t.A,{value:"postgres",label:"Postgres",children:(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"insert into BOOK(\n    NAME, EDITION, PRICE, STORE_ID\n) values(\n    ?, ?, ?, ?\n-- highlight-next-line\n) on conflict(\n    NAME, EDITION\n) do update set\n    PRICE = excluded.PRICE,\n    STORE_ID = excluded.STORE_ID\n/* batch-0: [SQL in Action, 1, 49.9, 100] */\n/* batch-1: [RUST programming, 2, 39.9, 100] */\n"})})})]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7b2c\u4e09\u6761SQL\u548c\u8fd9\u91cc\u8ba8\u8bba\u7684\u8bdd\u9898\u65e0\u5173\uff0c\u7701\u7565"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"\u540e\u7f6e\u5173\u8054\u7684\u529f\u80fd\u6bd4\u524d\u7f6e\u5173\u8054\u4e30\u5bcc\uff0c\u672c\u6559\u7a0b\u8bb2\u91cd\u70b9\u8ba8\u8bba\u540e\u7f6e\u5173\u8054"})})]})}function g(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(m,{...n})}):m(n)}},46845:(n,e,i)=>{i.d(e,{Y:()=>_});var l=i(96540),s=i(67733),r=i(67512),a=i(43581),t=i(80421),d=i(1489),c=i(71543),o=i(57416),h=i(53881),x=i(88933),u=i(46780),j=i(19591),m=i(618),g=i(73231),p=i(30854),A=i(16718),I=i(4671),v=i(67034),y=i(63051),O=i(15993),b=i(28968),k=i(13407),N=i(46831),E=i(44586),S=i(82470),f=i(16712),T=i(74848);const _=(0,l.memo)((()=>{const{i18n:n}=(0,E.A)(),e=(0,f.o)(),i=(0,l.useMemo)((()=>e?B:R),[e]),_=(0,l.useMemo)((()=>{const n=new Map;for(const e of i)n.set(e.id,e);return n}),[i]),P=(0,l.useMemo)((()=>e?D:C),[e]),q=(0,l.useMemo)((()=>{const n=new Map;for(const e of P)n.set(e.id,e);return n}),[P]),[L,w]=(0,S.e)((()=>({userId:1,province:_.get(1).province,city:_.get(1).city,address:_.get(1).address,items:[{__rowId:1,productId:1,name:q.get(1).name,quantity:2},{__rowId:2,productId:10,name:q.get(10).name,quantity:1}]}))),U=(0,l.useMemo)((()=>Math.max(...L.items.map((n=>n.__rowId)))+1),[L]),K=(0,l.useCallback)((n=>{const e=_.get(parseInt(n.target.value));void 0!==e&&w((n=>{n.userId=e.id,n.province=e.province,n.city=e.city,n.address=e.address}))}),[w,_]),Q=(0,l.useCallback)((n=>{w((e=>{e.province=n.target.value}))}),[w]),W=(0,l.useCallback)((n=>{w((e=>{e.city=n.target.value}))}),[w]),H=(0,l.useCallback)((n=>{w((e=>{e.address=n.target.value}))}),[w]),z=(0,l.useCallback)(((n,e)=>{w((i=>{for(const l of i.items)if(l.__rowId===e){l.productId=parseInt(n.target.value),M(i);break}}))}),[w]),G=(0,l.useCallback)(((n,e)=>{w((i=>{for(const l of i.items)if(l.__rowId===e){l.quantity=parseInt(n.target.value),M(i);break}}))}),[w]),V=(0,l.useCallback)((n=>{w((e=>{for(let i=e.items.length-1;i>=0;--i)if(e.items[i].__rowId===n){e.items.splice(i,1);break}}))}),[w]),J=(0,l.useCallback)((()=>{w((n=>{n.items.push({__rowId:U,quantity:1})}))}),[w,U]),[F,Y]=(0,l.useState)(!1),X=(0,l.useCallback)((()=>{Y(!0)}),[]),Z=(0,l.useCallback)((()=>{Y(!1)}),[]);return(0,T.jsxs)(o.A,{elevation:3,style:{padding:"1.5rem"},children:[(0,T.jsx)(s.A,{component:"form",noValidate:!0,autoComplete:"off",children:(0,T.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,T.jsx)(d.Ay,{item:!0,xs:4,children:(0,T.jsx)(a.A,{fullWidth:!0,select:!0,label:e?"\u8d2d\u4e70\u4eba":"Purchaser",value:L.userId,onChange:K,children:i.map((n=>(0,T.jsx)(t.A,{value:n.id,children:n.nickName},n.id)))})}),(0,T.jsx)(d.Ay,{item:!0,xs:4,children:(0,T.jsx)(a.A,{fullWidth:!0,label:e?"\u7701\u4efd":"Province",value:L.province,onChange:Q})}),(0,T.jsx)(d.Ay,{item:!0,xs:4,children:(0,T.jsx)(a.A,{fullWidth:!0,label:e?"\u57ce\u5e02":"City",value:L.city,onChange:W})}),(0,T.jsx)(d.Ay,{item:!0,xs:12,children:(0,T.jsx)(a.A,{fullWidth:!0,label:e?"\u5730\u5740":"Address",value:L.address,onChange:H})}),(0,T.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,T.jsx)(c.A,{textAlign:"left",children:e?"\u8ba2\u5355\u660e\u7ec6":"Order Items"}),(0,T.jsx)(j.A,{component:o.A,children:(0,T.jsxs)(h.A,{size:"small",children:[(0,T.jsx)(m.A,{children:(0,T.jsxs)(g.A,{children:[(0,T.jsx)(u.A,{children:e?"\u5546\u54c1":"Commodity"}),(0,T.jsx)(u.A,{children:e?"\u6570\u91cf":"Quantity"}),(0,T.jsx)(u.A,{children:e?"\u5355\u4ef7":"Unit price"}),(0,T.jsx)(u.A,{children:e?"\u660e\u7ec6\u4ef7":"Item price"}),(0,T.jsx)(u.A,{children:e?"\u5220\u9664":"Delete"})]})}),(0,T.jsx)(x.A,{children:L.items.map((n=>{const e=void 0!==n.productId?q.get(n.productId):void 0;return(0,T.jsxs)(g.A,{children:[(0,T.jsx)(u.A,{children:(0,T.jsx)(a.A,{select:!0,value:e?.id,variant:"standard",size:"small",onChange:e=>{z(e,n.__rowId)},children:P.map((n=>(0,T.jsx)(t.A,{value:n.id,children:n.name},n.id)))})}),(0,T.jsx)(u.A,{children:(0,T.jsx)(a.A,{type:"number",value:n.quantity,variant:"standard",size:"small",onChange:e=>{G(e,n.__rowId)}})}),(0,T.jsx)(u.A,{children:e?.price}),(0,T.jsx)(u.A,{children:void 0!==e&&e.price*n.quantity}),(0,T.jsx)(u.A,{children:(0,T.jsx)(I.A,{onClick:()=>V(n.__rowId),children:(0,T.jsx)(v.A,{})})})]},n.__rowId)}))}),(0,T.jsx)(p.A,{children:(0,T.jsx)(g.A,{children:(0,T.jsx)(u.A,{colSpan:5,children:(0,T.jsxs)(r.A,{onClick:J,children:[(0,T.jsx)(A.A,{}),e?"\u6dfb\u52a0":"Add"]})})})})]})})]}),(0,T.jsxs)(d.Ay,{item:!0,xs:12,children:[e?"\u603b\u989d":"Total price",":",L.items.filter((n=>void 0!==n.productId&&"number"==typeof n.quantity)).map((n=>q.get(n.productId).price*n.quantity)).reduce(((n,e)=>n+e),0)]}),(0,T.jsx)(d.Ay,{item:!0,xs:12,children:(0,T.jsx)(r.A,{variant:"contained",onClick:X,children:e?"\u63d0\u4ea4":"Submit"})})]})}),(0,T.jsxs)(y.A,{open:F,onClose:Z,children:[(0,T.jsx)(N.A,{children:e?"\u4fe1\u606f":"Info"}),(0,T.jsx)(b.A,{children:(0,T.jsx)(k.A,{children:e?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect"})}),(0,T.jsx)(O.A,{children:(0,T.jsx)(r.A,{onClick:Z,children:e?"\u5173\u95ed":"Close"})})]})]})})),B=[{id:1,nickName:"\u76ae\u76ae\u9c81",province:"\u56db\u5ddd",city:"\u6210\u90fd",address:"\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"},{id:2,nickName:"\u9c81\u897f\u897f",province:"\u5e7f\u4e1c",city:"\u5e7f\u5dde",address:"\u767d\u4e91\u533a\u77f3\u6c99\u8def300\u53f7"},{id:3,nickName:"\u8212\u514b",province:"\u897f\u85cf",city:"\u62c9\u8428",address:"\u5806\u9f99\u5fb7\u5e86\u533a"},{id:4,nickName:"\u8d1d\u5854",province:"\u4e0a\u6d77",city:"\u4e0a\u6d77",address:"\u6d66\u4e1c\u65b0\u533a\u79c0\u6cbf\u897f\u8def218\u5f04"}],R=[{id:1,nickName:"Schneewittchen",province:"Berlin",city:"Prenzlauer Berg",address:"Brandenburgische Stra\xdfe 9, Prenzlauer Berg, Berlin, Germany"},{id:2,nickName:"Cinderella",province:"Basse-Normandie",city:"Lisieux",address:"20 rue L\xe9on Dierx, Lisieux, Basse-Normandie, France"},{id:3,nickName:"Nuwa",province:"ShanXi",city:"Taiyuan",address:"Qian Feng Nan Lu 99hao, Taiyuan, ShanXi, China"},{id:4,nickName:"Pinocchio",province:"Palazzo Pignano",city:"Cremona",address:"Via Giovanni Amendola 134, Palazzo Pignano, Cremona, Italy"}],D=[{id:1,name:"zippo\u591c\u5149\u6d41\u6c99\u6253\u706b\u673a",price:268},{id:2,name:"\u6770\u767b(Jayden)\u5370\u5ea6\u5854\u5e03\u62c9\u9f13",price:9238},{id:3,name:"\u6d6a\u7434(Longines)\u673a\u68b0\u624b\u8868",price:13900},{id:4,name:"viney\u7537\u58eb\u76ae\u5e26",price:139},{id:5,name:"\u96c5\u8bd7\u5170\u9edb\u7ed2\u96fe\u54d1\u5149\u5507\u818f",price:310},{id:6,name:"CIRCUIT\u7537\u5b50\u6ed1\u96ea\u5355\u677f",price:2044},{id:7,name:"\u7279\u4ed1\u82cf\u8131\u8102\u725b\u5976",price:47},{id:8,name:"\u4e50\u9ad8\u79ef\u6728\u5e03\u52a0\u8fea",price:374},{id:9,name:"\u53cc\u559c\u71c3\u6c14\u7535\u78c1\u901a\u7528\u538b\u529b\u9505",price:137},{id:10,name:"\u61a8\u61a8\u5ba0\u732b\u722c\u67b6",price:238}],C=[{id:1,name:"Timeless Vitamin C Plus E 10 Percent Ferulic Acid Serum Serum Unisex 1 oz",price:14.69},{id:2,name:"Dockers Men's Tiller Boat Shoe",price:52.41},{id:3,name:"Paxcoo 124 Skeins Embroidery Floss Cross Stitch Thread with Needles",price:29.99},{id:4,name:"Michael Kors Crossbody",price:70.6},{id:5,name:"Crocs unisex-child Classic Graphic Clog",price:34.99},{id:6,name:"Timex Time Machines Digital 35mm Watch",price:28.95},{id:7,name:"Scalex Mite & Lice Spray for Birds, 8 oz.",price:14.75},{id:8,name:"Under Armour Men's Storm Liner",price:13.03},{id:9,name:"Nike Women's Pro 3\" Training Shorts",price:35.86},{id:10,name:"Olaplex No. 4 Bond Maintenance Shampoo",price:30}];function M(n){const e=n.items,i=new Map;for(let l=0;l<e.length;l++){const n=e[l];if("number"!=typeof n.quantity)n.quantity=1;else if(n.quantity<1){e.splice(l--,1);continue}if(void 0===n.productId)continue;const s=i.get(n.productId);void 0===s?i.set(n.productId,n):(s.quantity+=n.quantity,e.splice(l--,1))}}},64087:(n,e,i)=>{i.d(e,{M:()=>I});var l=i(44586),s=i(31729),r=i(48440),a=i(80421),t=i(57416),d=i(18441),c=i(96125),o=i(43581),h=i(63051),x=i(46831),u=i(28968),j=i(15993),m=i(13407),g=i(67512),p=i(96540),A=i(74848);const I=(0,p.memo)((()=>{const[n,e]=(0,p.useState)((()=>({name:"Learning GraphQL",edition:1,price:45,storeId:1,authorIds:[1,2]}))),i=(0,p.useCallback)((n=>{e((e=>({...e,name:n.target.value})))}),[]),I=(0,p.useCallback)((n=>{e((e=>({...e,edition:n.target.valueAsNumber})))}),[]),v=(0,p.useCallback)((n=>{e((e=>({...e,price:n.target.valueAsNumber})))}),[]),y=(0,p.useCallback)((n=>{let i;const l=n.target.value;i="string"==typeof l?parseInt(l):l,-1===i&&(i=void 0),e((n=>({...n,storeId:i})))}),[]),O=(0,p.useCallback)((n=>{let i=[];console.log(n.target.value);const l=n.target.value;i="string"==typeof l?l.split(",").map((n=>parseInt(n))):l,e((n=>({...n,authorIds:i})))}),[]),{i18n:b}=(0,l.A)(),k=(0,p.useMemo)((()=>"zh"==b.currentLocale||"zh_cn"==b.currentLocale||"zh_CN"==b.currentLocale),[b.currentLocale]),[N,E]=(0,p.useState)(!1),S=(0,p.useCallback)((()=>{E(!0)}),[]),f=(0,p.useCallback)((()=>{E(!1)}),[]);return(0,A.jsxs)(t.A,{elevation:3,style:{padding:"1.5rem",width:500},children:[(0,A.jsxs)(c.A,{spacing:2,children:[(0,A.jsx)("h1",{children:"Book Form"}),(0,A.jsx)(o.A,{label:"Name",value:n.name,onChange:i,error:""===n.name,helperText:""===n.name?"Name is required":""}),(0,A.jsx)(o.A,{label:"Edition",type:"number",value:n.edition,onChange:I}),(0,A.jsx)(o.A,{label:"Price",type:"number",value:n.price,onChange:v}),(0,A.jsxs)(s.A,{fullWidth:!0,children:[(0,A.jsx)(r.A,{id:"store-select-label",children:"Store"}),(0,A.jsxs)(d.A,{labelId:"store-select-label",label:"Authors",value:n.storeId,onChange:y,children:[(0,A.jsx)(a.A,{value:-1,children:"--NONE--"}),(0,A.jsx)(a.A,{value:1,children:"O'REILLY"}),(0,A.jsx)(a.A,{value:2,children:"MANNING"})]})]}),(0,A.jsxs)(s.A,{fullWidth:!0,children:[(0,A.jsx)(r.A,{id:"author-multi-select-label",children:"Authors"}),(0,A.jsxs)(d.A,{multiple:!0,labelId:"author-multi-select-label",label:"Authors",value:n.authorIds,onChange:O,children:[(0,A.jsx)(a.A,{value:1,children:"Eve Procello"}),(0,A.jsx)(a.A,{value:2,children:"Alex Banks"}),(0,A.jsx)(a.A,{value:3,children:"Dan Vanderkam"}),(0,A.jsx)(a.A,{value:4,children:"Boris Cherny"}),(0,A.jsx)(a.A,{value:5,children:"Samer Buna"})]})]}),(0,A.jsx)(s.A,{children:(0,A.jsx)(g.A,{onClick:S,variant:"contained",children:k?"\u63d0\u4ea4":"Submit"})})]}),(0,A.jsxs)(h.A,{open:N,onClose:f,children:[(0,A.jsx)(x.A,{children:k?"\u4fe1\u606f":"Info"}),(0,A.jsx)(u.A,{children:(0,A.jsx)(m.A,{children:k?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect"})}),(0,A.jsx)(j.A,{children:(0,A.jsx)(g.A,{onClick:f,children:"\u5173\u95ed"})})]})]})}))},66971:(n,e,i)=>{i.d(e,{a:()=>m});var l=i(96540),s=i(72774),r=i(63051),a=i(28968),t=i(48875),d=i(44676),c=i(47859),o=i(4671),h=i(99343),x=i(7324),u=i(39781),j=i(74848);const m=(0,l.memo)((n=>{let{open:e,fullScreen:i=!1,title:t,maxWidth:m="md",onClose:p,children:A}=n;const[I,v]=(0,l.useState)(i),y=(0,l.useCallback)((()=>{v((n=>!n))}),[]);return(0,j.jsxs)(r.A,{open:e,onClose:p,fullScreen:I,TransitionComponent:g,maxWidth:m,children:[(0,j.jsx)(s.A,{sx:{position:"relative"},children:(0,j.jsxs)(d.A,{children:[(0,j.jsx)(c.A,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:t}),(0,j.jsx)(o.A,{onClick:y,style:{color:"white"},children:I?(0,j.jsx)(x.A,{}):(0,j.jsx)(h.A,{})}),(0,j.jsx)(o.A,{"aria-label":"close",onClick:p,style:{color:"white"},children:(0,j.jsx)(u.A,{})})]})}),(0,j.jsx)(a.A,{children:A})]})})),g=l.forwardRef((function(n,e){return(0,j.jsx)(t.A,{direction:"up",ref:e,...n})}))},74400:(n,e,i)=>{i.d(e,{l:()=>t});var l=i(96540),s=i(67512),r=i(66971),a=i(74848);const t=(0,l.memo)((n=>{let{buttonText:e,fullScreen:i=!1,title:t=e,variant:d="outlined",large:c=!1,maxWidth:o,useOriginalText:h=!0,children:x}=n;const[u,j]=(0,l.useState)(!1),m=(0,l.useCallback)((n=>{j(!0),n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}),[]),g=(0,l.useCallback)((()=>{j(!1)}),[]),p=h?{textTransform:"none"}:{};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.A,{"data-is-view-more-button":"true",onClick:m,variant:d,size:c?"large":"small",style:p,children:e}),(0,a.jsx)(r.a,{open:u,onClose:g,title:t,maxWidth:o,fullScreen:i,children:x})]})}))},16712:(n,e,i)=>{i.d(e,{o:()=>s});var l=i(44586);function s(){const{i18n:n}=(0,l.A)(),e=n.currentLocale;return"zh"===e||"zh_cn"===e||"zh_CN"==e}}}]);